\documentclass{beamer}

%\input{odl_preamble.tex}
% The amssymb package provides various useful mathematical symbols
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{graphicx} % for includegraphics
\usepackage{xspace} % needed for \eg, \ie, \etc
\usepackage{bm} % for bold math
\usepackage{threeparttable} % for tables with footnotes
%\usepackage{subfigure}
\usepackage[ruled,lined,linesnumbered]{algorithm2e}

% hyperref must be last
% Commented out 20151129 - AA
%\usepackage{hyperref}
%\hypersetup{
%  colorlinks=true,
%  linkcolor=red,
%  citecolor=green,
%  urlcolor=blue
%}
  
% We often use mathcal for functions
\newcommand{\fnc}[1]{\ensuremath{\mathcal{#1}}}
\newcommand{\vecfnc}[1]{\ensuremath{\boldsymbol{\mathcal{#1}}}} % vector function

% matrices are often math sans serif type
\newcommand{\mat}[1]{\ensuremath{\mathsf{#1}}}

% SBP operator matrices

% command latin phrases and other short-forms
\newcommand{\etal}[0]{{\em et~al.\@}\xspace}
\newcommand{\eg}[0]{{e.g.\@}\xspace}
\newcommand{\ie}[0]{{i.e.\@}\xspace}
\newcommand{\viz}[0]{{viz.\@}\xspace}
\newcommand{\resp}[0]{{resp.\@}\xspace}

% Misc. commands
\newcommand{\ignore}[1]{} % comment out large sections of code

%\usepackage{cite}
%\usepackage{graphicx}
\usepackage{subcaption}

\usepackage[scale=2]{ccicons}
%\usepackage{bm}
\usepackage{tikz}
%\graphicspath{{./results/nozzle/}}
%\usepackage{amsmath}
%\usepackage{amsfonts}
%\usepackage{amsthm}
%\usepackage{amssymb}
\usepackage{amstext}
\usepackage{amsbsy}
\usepackage{amsopn}
\usepackage{array}
%\usepackage[labelformat=empty]{subfig}
%\usepackage{subfigure}
%\usepackage{subfig}
\usepackage{verbatim}
\usepackage{minted}
%\usepackage{subfigmat} 
%\usepackage{bm}
%\usepackage{threeparttable}
%%\usepackage{dcolumn}
\newcolumntype{d}{D{.}{.}{-1}}
%\usepackage{hhline}
%\usepackage{xspace}
%\usepackage[ruled,linesnumbered]{algorithm2e}

\newcommand{\ttt}{\texttt}
\newcommand{\die}{\partial}
%\newcommand{\ds}{\mathrm{d}s}




%  \bibliographystyle{plain}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usetheme{Berlin}
\usecolortheme{beaver}

\beamertemplatenavigationsymbolsempty
%\setbeamertemplate{bibliography item}{\insertbiblabel}

\captionsetup[figure]{labelformat=empty}
%\setbeamertemplate{footline}[frame number]
%\addtobeamertemplate{footline}[frame number]
\expandafter\def\expandafter\insertshorttitle\expandafter{%
  \insertshorttitle\hfill%
  \insertframenumber\,/\,\inserttotalframenumber}
  
\AtBeginSection[]
{
  \begin{frame}
    \frametitle{Table of Contents}
    \tableofcontents[currentsection]
  \end{frame}
}

\title{Julia Petsc Interface}
%\subtitle{Volume Integration, Edge Stabilization, Administration}
%\author[]{Jared Crean, Kinshuk Panda, Anthony Ashley, Jason Hicken}
%\author[Jared Crean, Kinshuk Panda,Anthony Ashley,Jason Hicken]{Jared Crean, Kinshuk Panda, Anthony Ashley, Jason Hicken}
%\institute{Rensselaer Polytechnic Institute}
\date{January 6, 2016}
%\titlegraphic{\includegraphics[width=\textwidth]{logo_both4.png}}

\begin{document}

\begin{frame}
\titlepage
\end{frame}

\begin{frame}{What is Petsc?}
Portable, Extensible Toolkit for Scientific Computation, provides all the 
capabilities needed to assembled and solve systems of linear and non-linear 
equations
arising from discretizing partial differential equations on supercomputers.
\begin{itemize}
  \item Vec: distributed memory vectors
  \item Mat: distributed memory sparse matrices
  \item Mappings: Index Sets, Application Orderings, Local to Global Mappings
  \item KSP: Krylov solvers for linear systems
  \item SNES: Non-linear equation solvers (globalized Newton)
  \item TS: time stepping for ODEs and DAEs
\end{itemize}
\end{frame}


\begin{frame}{Wrapping Petsc}
Petsc is a dynamic, polymorphic C library 
\begin{itemize}
  \item Each type (Vec, Mat, etc.) has multiple implimentations
  \item All implimentations expose a standard interface
\end{itemize}
\hfill

To generate Julia wrappers:
\begin{itemize}
  \item Clang.jl reads the Petsc header files, generates equivalent Julia code (if given the right preprocessor flags)
  \item Use a rewriter function to map the Julia types to more useful types
\end{itemize}

\end{frame}


\begin{frame}[fragile]{The Rewriter}
For each Petsc object, introduce a Julia immutable type
\begin{itemize}
  \item Parameterize on datatype \texttt{T} to enable dispatch
\end{itemize}
\begin{minted}{julia}
  typealias Mat Ptr{_p_Mat} -> immutable Mat{T}
\end{minted}
\hfill

Also map C equivalent types to more general types:
%\begin{itemize}
\begin{minted}{julia} 
  Ptr{Float64} -> Union{DenseArray{Float64},
                        Ptr{Float64}, Ref{Float64}}
\end{minted}
%\end{itemize}
\hfill

Implemented with a recursive descent search and replace on the \texttt{Expr}s 
generated by Clang.jl

\end{frame}

\begin{frame}[fragile]{Petsc Arrays}
Petsc \texttt{Vec}s and \texttt{Mat}s are mostly \texttt{AbstractArrays}
\begin{itemize}
  \item indexing, length, size
  \item lengthlocal, sizelocal, LocalArray, SubMatrix
  \item need to call \texttt{AssemblyBegin} and \texttt{AssemblyEnd} for indexing operations to take effect
\end{itemize}

\begin{minted}{julia}
type Mat{T, MType} <: AbstractSparseMatrix{T, PetscInt}
  p::C.Mat{T}
  ... other fields ...
end
\end{minted}




\end{frame}

\begin{frame}[fragile]{Options Paradigm}
Petsc uses an global database to set all the options for its components
\begin{itemize}
  \item \textbf{All} the options
  \item Allows maximum control with minimal API
\end{itemize}
\hfill

Ex.
\begin{minted}{julia}
  Options[Float64]("ksp_type") = "fgmres"
  Options[Float64]("ksp_gmres_modifiedgramschmidt") = ""
  Options[Float64]("pc_type") = "ilu"
  Options[Float64]("pc_factor_levels") = "3"
\end{minted}

\end{frame}

\begin{frame}{Composability}
Petsc is highly composable
\begin{itemize}
  \item \texttt{Mat} + Krylov options + pre-conditioner $\rightarrow$ \texttt{KSP}
  \item \texttt{KSP} + Jacobian function $\rightarrow$ \texttt{SNES}
  \item \texttt{SNES} + function evaluation $\rightarrow$ \texttt{TS}
\end{itemize}
\hfill

The user forms the system, PETSc contains the algorithms to solve it
\end{frame}



\begin{frame}{Krylov Solvers}
\hfill

A wide variety of Krylov methods and pre-conditioners are available
\begin{itemize}
  \item GMRES, fGMRES, lGMRES, ...
  \item iLU(k), Jacobi, block Jacobian, SOR, ...
  \item Can use different matrices for solve, preconditioner
  \item Also supports matrix-free methods
\end{itemize}
\hfill

Backslash on a PETSc matrix uses default settings, users can create KSP object for more granular control
\end{frame}

\begin{frame}{Future Work}
  \begin{itemize}
    \item SNES
    \item More Vec abstractions
    \item More Mat constructors
    \item Iteration?
  \end{itemize}
\end{frame}

\begin{frame}
\begin{center} \usebeamerfont*{frametitle} \usebeamercolor[fg]{frametitle}
Any Questions?
\end{center}

\end{frame}


\end{document}





























